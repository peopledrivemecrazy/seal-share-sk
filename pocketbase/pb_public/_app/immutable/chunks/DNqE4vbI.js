import{b as u,a as y,e as g}from"./Dw5N5MVz.js";import{p as r}from"./BT_lkVjL.js";import{g as i}from"./Dnf-jpWp.js";const b=async()=>await r.collection("messages").getFullList(),_=async e=>{var o;const t=await r.collection("messages").getOne(e),s="replaceMeWithUserInput",c=(o=r.authStore.record)==null?void 0:o.email,a=localStorage.getItem("privatekey_"+c);if(!a)throw"No Private Key";const n=await u(t.encrypted_message,a,s);return{...t,decrypted_message:n}},D=async({recipientId:e,message:t,files:s})=>{var p;const c=Object.values(s).map(m=>new File([m],m.name)),a=await l(c,e),n={sender:(p=r.authStore.record)==null?void 0:p.id,recipient:e,encrypted_message:y(t,(await i(e)).public_key),files:a,public_key:(await i(e)).id};return await r.collection("messages").create(n)},l=async(e,t)=>{const s=await i(t);return s?e.map(a=>g(a.arrayBuffer(),s.public_key)):!1};export{_ as a,b as g,D as s};
