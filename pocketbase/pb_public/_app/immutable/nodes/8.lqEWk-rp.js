import{t as fe,a as n,b as i}from"../chunks/BFXbanDE.js";import{p as $e,b as d,s as r,f as me,t as T,a as ke,g as a,e as be,d as l,n as p,c as k,r as b}from"../chunks/BbX6vshq.js";import{s as y}from"../chunks/BVo5oiMs.js";import{p as c}from"../chunks/zlAFByCr.js";import{B as u}from"../chunks/B5sa7d2P.js";import{I as $}from"../chunks/BITCnyRI.js";import{g as ee,a as xe,b as Pe}from"../chunks/Dw5N5MVz.js";import{p as o}from"../chunks/BT_lkVjL.js";var Me=fe("<h1>Sandbox</h1> <!> <!> <!> <h2>Authentication</h2> <h3>Otp step 1</h3> <!> <!> <h3>Otp step 2</h3> <!> <!> <h2>Save pgp key</h2> <!> <h2>Send Encrypted Message</h2> <!> Message: <!> Key Id: <!> <pre> </pre> <!> <h2>Decrypted Message</h2> <!> <pre> </pre> Message Id: <!> <pre> </pre> <!> <pre> </pre>",1);function Ce(te,se){$e(se,!0);const C=()=>{console.log(C)},re=async()=>{const e=await o.collection("test").getOne("408a03k76nkg4et");console.log(e)};let E=d(c({privateKey:"",publicKey:"",revocationCertificate:""}));const ae=async()=>{const{privateKey:e,publicKey:s,revocationCertificate:t}=await ee("test@test.com","test");l(E,c({privateKey:e,publicKey:s,revocationCertificate:t}))};let x=d(""),P=d(""),m=d("");const oe=async()=>{const e=await o.collection("users").requestOTP(a(x));l(P,c(e.otpId)),l(m,""),console.log({result:e})},ce=async()=>{const e=await o.collection("users").authWithOTP(a(P),a(m));console.log({authData:e})},ne=async()=>{var _,f;const e=(_=o.authStore.record)==null?void 0:_.email;if(!e)throw"No User";const{privateKey:s,publicKey:t,revocationCertificate:g}=await ee(e,"replaceMeWithUserInput");console.log(o.authStore.record),localStorage.setItem("privatekey_"+e,s);const v={user:(f=o.authStore.record)==null?void 0:f.id,key_name:`${e} public key ${new Date().toString()}`,public_key:t,fingerprint:"TODO"},h=await o.collection("user_public_keys").create(v);console.log({record:h})};let M=d(""),S=d("");const le=async()=>{var f;const e=(f=o.authStore.record)==null?void 0:f.id,s=a(K).find(_e=>_e.id===a(S));if(!s)throw"No Public key found";console.log({selectedKey:s});const{id:t,public_key:g,user:v}=s,h=await xe(a(M),g),_={sender:e,recepient:v,encrypted_message:h,public_key:t};console.log({data:_}),await o.collection("messages").create(_)};let K=d(c([]));const ie=async()=>{const e=await o.collection("user_public_keys").getFullList();l(K,c(e??[])),console.log({records:e})};let w=d(c([])),O=d(""),F=d("");const de=async()=>{const e=await o.collection("messages").getFullList();l(w,c(e??[]))},pe=async()=>{var v;const e=(v=o.authStore.record)==null?void 0:v.email,s=localStorage.getItem("privatekey_"+e);if(!s)throw"No Private Key";const t=a(w).find(h=>h.id=a(O));if(!t)throw"No Message found";const g=await Pe(t.encrypted_message,s,"replaceMeWithUserInput");l(F,c(g.decrypted_message))};var J=Me(),W=r(me(J),2);u(W,{onclick:C,children:(e,s)=>{p();var t=i("console.log");n(e,t)},$$slots:{default:!0}});var G=r(W,2);u(G,{onclick:re,children:(e,s)=>{p();var t=i("Fetch data");n(e,t)},$$slots:{default:!0}});var U=r(G,2);u(U,{onclick:ae,children:(e,s)=>{p();var t=i("Generate keys");n(e,t)},$$slots:{default:!0}});var B=r(U,6);$(B,{get value(){return a(x)},set value(e){l(x,c(e))}});var L=r(B,2);u(L,{onclick:oe,children:(e,s)=>{p();var t=i("Get OTP");n(e,t)},$$slots:{default:!0}});var q=r(L,4);$(q,{get value(){return a(m)},set value(e){l(m,c(e))}});var A=r(q,2);u(A,{onclick:ce,children:(e,s)=>{p();var t=i();T(()=>y(t,`Verify OTP for id (${a(P)??""})`)),n(e,t)},$$slots:{default:!0}});var V=r(A,4);const ue=be(()=>{var e;return!((e=o.authStore.record)!=null&&e.email)});u(V,{get disabled(){return a(ue)},onclick:ne,children:(e,s)=>{p();var t=i();T(()=>{var g;return y(t,`Create and save pgp key for ${((g=o.authStore.record)==null?void 0:g.email)??""}`)}),n(e,t)},$$slots:{default:!0}});var j=r(V,4);u(j,{onclick:ie,children:(e,s)=>{p();var t=i("Get Public Keys");n(e,t)},$$slots:{default:!0}});var z=r(j,2);$(z,{get value(){return a(M)},set value(e){l(M,c(e))}});var H=r(z,2);$(H,{get value(){return a(S)},set value(e){l(S,c(e))}});var I=r(H,2),ge=k(I,!0);b(I);var Q=r(I,2);u(Q,{onclick:le,children:(e,s)=>{p();var t=i("Save Encrypted Message");n(e,t)},$$slots:{default:!0}});var R=r(Q,4);u(R,{onclick:de,children:(e,s)=>{p();var t=i("Fetch Messages");n(e,t)},$$slots:{default:!0}});var N=r(R,2),ve=k(N,!0);b(N);var X=r(N,2);$(X,{get value(){return a(O)},set value(e){l(O,c(e))}});var D=r(X,2),ye=k(D,!0);b(D);var Y=r(D,2);u(Y,{onclick:pe,children:(e,s)=>{p();var t=i("Decrypt Message");n(e,t)},$$slots:{default:!0}});var Z=r(Y,2),he=k(Z,!0);b(Z),T((e,s,t,g)=>{y(ge,e),y(ve,s),y(ye,t),y(he,g)},[()=>JSON.stringify(a(K),null,2),()=>JSON.stringify(a(w),null,2),()=>JSON.stringify(a(F),null,2),()=>JSON.stringify(a(E),null,2)]),n(te,J),ke()}export{Ce as component};
